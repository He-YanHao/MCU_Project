# 示波器

## 项目说明

基于STM32f407的示波器。

使用DMA搬运两个包含135个成员的uint8_t数据类型的数组ADC_Num1 ADC_Num2

流程：

1. ADC_Num1接收数据
2. 使用ADC_Num2的数据清除上一次图像
3. 使用ADC_Num1的数据制作这一次图像
4. 搬运数据ADC_Num1-->ADC_Num2
5. 循环

## 工程目录介绍

```makefile
| -- App：状态机、数据处理、算法等
|    | -- Inc：
|    |    | -- Delay.h：延时函数头文件
|    |    | -- UI.h：示波器UI头文件
|    |    | -- MyADC.h：ADC数据处理
|    | -- Src:
|    |    | -- Delay.c：延时函数
|    |    | -- UI.c：示波器UI
|    |    | -- MyADC.c：ADC数据处理
| -- BSP：板级外设代码
|    | -- Inc：
|    |    | -- .h：头文件
|    |    | -- .h：头文件
|    | -- Src:
|    |    | -- .c：
|    |    | -- .c：
| -- Core：ARM核心代码
|    | -- Inc：
|    |    | -- .h：头文件
|    |    | -- .h：头文件
|    | -- Src:
|    |    | -- .c：
|    |    | -- .c：
| -- MDK-ARM：工程
| -- Middlewares：协议栈
| -- STM32F4xx_Driver：STM外设驱动库
|    | -- Inc：头文件
|    | -- Src：函数
```

## 接线

```
开发板    屏幕
GND      GND地线
VCC      VDD电源线
PA5      SCL时钟线
PA7      SDA数据
PA3      RST复位
PA2      DC数据命令选择
PA4      CS片选输入
PA1      BLK背光控制线
```

## 界面介绍

```
    //等待发送缓冲区为空
    while(RESET == SPI_I2S_GetFlagStatus(SPI1,  SPI_I2S_FLAG_TXE) );
    //通过SPI4发送一个字节数据
    SPI_I2S_SendData(SPI1, dat);
    //等待接收缓冲区不空标志
    while(RESET == SPI_I2S_GetFlagStatus(SPI1,  SPI_I2S_FLAG_RXNE) );
    SPI_I2S_ReceiveData(SPI1);
```



```
选用的LCD屏幕 X128像素，Y160像素。
示波器使用时需要将屏幕倾斜90°
4095/39=105
    X
    *(127,24)                                                                     *(127,159)
----+
预  +
留  +
----+
3   +
个  +
----+
字  +
母  +
----+
空  +
间  +
----+
    +
    +
----+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++（21，159）Y
    *(21,24)    文字显示区

详细分割线：
X：0~21文字显示区域 21分割线 22~126图像显105示区域
Y：0~23文字显示区域 24分割线 25~159图像135显示区域

22 25
37 40
52 55
70
82 85
100
112 115
127 130
145
 160

示波器Div含义为时基单元，这里每5像素作为一个Div

有一个问题，一般示波器可以接收到正电压和负电压，但是单片机不可以。
解决办法，使用一个加法器，将采样源加上5V，然后进行数值计算。

若作为可调示波器，挡位可选择
1s/Div




20,20	20,20
0,20	20,0
20,0	0,20
20,100	100,20
100,20	
```

